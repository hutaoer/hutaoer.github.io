(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{323:function(t,a,e){"use strict";e.r(a);var s=e(14),r=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"mongodb-学习笔记-基础"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-学习笔记-基础"}},[t._v("#")]),t._v(" MongoDB 学习笔记 —— 基础")]),t._v(" "),a("h2",{attrs:{id:"基本概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本概念"}},[t._v("#")]),t._v(" 基本概念")]),t._v(" "),a("ul",[a("li",[t._v("它是一个基于分布式文件存储的开源数据库系统。在高负载的情况下，添加更多的节点，可以保证服务器性能。")]),t._v(" "),a("li",[t._v("它将数据存储为一个文档，数据结构为键值对，类似于JSON对象。")]),t._v(" "),a("li",[t._v("文档不需要设置相同的字段，并且相同的字段不需要相同的数据类型，这与关系型数据库有很大的区别，也是 MongoDB 非常突出的特点。")])]),t._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),a("ul",[a("li",[t._v("添加到"),a("code",[t._v("PATH")]),t._v("，"),a("code",[t._v("export PATH=/usr/local/mongodb/bin:$PATH")])]),t._v(" "),a("li",[t._v("启动"),a("code",[t._v("mongod --dbpath /usr/local/var/mongodb --logpath /usr/local/var/log/mongodb/mongo.log --fork")])])]),t._v(" "),a("h3",{attrs:{id:"sql-和-mongodb-术语对比"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sql-和-mongodb-术语对比"}},[t._v("#")]),t._v(" SQL 和 MongoDB 术语对比")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("SQL")]),t._v(" "),a("th",[t._v("MongoDB")]),t._v(" "),a("th",[t._v("备注")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("database（数据库）")]),t._v(" "),a("td",[t._v("database（数据库）")]),t._v(" "),a("td",[t._v("相同")])]),t._v(" "),a("tr",[a("td",[t._v("table （数据库表）")]),t._v(" "),a("td",[t._v("collection（集合）")]),t._v(" "),a("td",[t._v("不同")])]),t._v(" "),a("tr",[a("td",[t._v("row（数据记录）")]),t._v(" "),a("td",[t._v("document（文档）")]),t._v(" "),a("td",[t._v("不同")])]),t._v(" "),a("tr",[a("td",[t._v("column（数据字段）")]),t._v(" "),a("td",[t._v("field（域）")]),t._v(" "),a("td",[t._v("不同")])]),t._v(" "),a("tr",[a("td",[t._v("index（索引）")]),t._v(" "),a("td",[t._v("index（索引）")]),t._v(" "),a("td",[t._v("相同")])]),t._v(" "),a("tr",[a("td",[t._v("table joins （表连接）")]),t._v(" "),a("td",[t._v("不支持表连接，支持嵌入文档")]),t._v(" "),a("td",[t._v("不同")])]),t._v(" "),a("tr",[a("td",[t._v("primary key（主键）")]),t._v(" "),a("td",[t._v("primary key（自动将_id设置为主键）")]),t._v(" "),a("td",[t._v("不同")])])])]),t._v(" "),a("ul",[a("li",[t._v("注意：\n"),a("ul",[a("li",[t._v("文档的键，这个键的值可以是任何类型的，默认是个 ObjectId 对象")]),t._v(" "),a("li",[t._v("文档中的键/值对是有序的。")]),t._v(" "),a("li",[t._v("键不能含有\\0 (空字符)。这个字符用来表示键的结尾。")]),t._v(" "),a("li",[t._v(".和$有特别的意义，只有在特定环境下才能使用。")])])])]),t._v(" "),a("h3",{attrs:{id:"数据类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据类型"}},[t._v("#")]),t._v(" 数据类型")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("String")]),t._v(": 字符串，UTF-8 编码的字符串才是合法的。")]),t._v(" "),a("li",[a("code",[t._v("Array")]),t._v(": 用于将数组或列表或多个值存储为一个键。")]),t._v(" "),a("li",[a("code",[t._v("Timestamp")]),t._v(": 时间戳。")]),t._v(" "),a("li",[a("code",[t._v("Object")]),t._v(": 用于内嵌文档。")]),t._v(" "),a("li",[a("code",[t._v("Object ID")]),t._v(": 对象ID，用于创建文档的ID")]),t._v(" "),a("li",[a("code",[t._v("Code")]),t._v(": 代码类型，用于在文档中存储 "),a("code",[t._v("javascript")]),t._v("代码。")])]),t._v(" "),a("h2",{attrs:{id:"常用api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用api"}},[t._v("#")]),t._v(" 常用API")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("show dbs")]),t._v("，查看数据库。")]),t._v(" "),a("li",[a("code",[t._v("use [dbName]")]),t._v("，使用某个数据库，若不存在，则创建该数据库。")]),t._v(" "),a("li",[a("code",[t._v("db.DropDatabase()")]),t._v(", 切换到某个数据库下面后，使用该命令，可删除该数据库。")]),t._v(" "),a("li",[a("code",[t._v("show tables")]),t._v(" or "),a("code",[t._v("show collections")]),t._v("，显示数据下的集合。")]),t._v(" "),a("li",[a("code",[t._v("db.createCollection(name, options)")]),t._v("，创建集合，options为选项。")]),t._v(" "),a("li",[a("code",[t._v("db.tbName.drop()")]),t._v(", tbName为集合名字，使用该命令可删除该集合。")]),t._v(" "),a("li",[a("code",[t._v("db.tbName.find()")]),t._v(", 查看tbName中的文档。")])]),t._v(" "),a("h3",{attrs:{id:"插入文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#插入文档"}},[t._v("#")]),t._v(" 插入文档")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("db.tbName.insert(document)")]),t._v("，插入文档。当插入文档的时候，会自动创建集合。")]),t._v(" "),a("li",[a("code",[t._v("db.tbName.save(document)")]),t._v(", 该方法新版本中已经废弃。")]),t._v(" "),a("li",[t._v("3.2版本后，新增了方法：\n"),a("ul",[a("li",[a("code",[t._v("db.collection.insertOne()")]),t._v("，用于插入一条数据")]),t._v(" "),a("li",[a("code",[t._v("db.collection.insertMany()")]),t._v("，用于插入多条数据")])])]),t._v(" "),a("li",[t._v("也可以将文档数据存到一个变量中，通过传参的方式进行插入。")])]),t._v(" "),a("h3",{attrs:{id:"更新文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更新文档"}},[t._v("#")]),t._v(" 更新文档")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("db.collection.save(document)")]),t._v(",save() 方法通过传入的文档来替换已有文档，"),a("code",[t._v("_id")]),t._v("主键存在就更新，不存在就插入。")]),t._v(" "),a("li",[a("code",[t._v("update")]),t._v("方法：")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("collection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// query : update的查询条件，类似sql update查询内where后面的。")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("update"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// update的对象和一些更新的操作符（如$,$inc...）等，也可以理解为sql update查询内set后面的")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("upsert")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("boolean"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("multi")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("boolean"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("writeConcern")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("document"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h3",{attrs:{id:"删除文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除文档"}},[t._v("#")]),t._v(" 删除文档")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("collection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("remove")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("justOne")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("boolean"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("writeConcern")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("document"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ul",[a("li",[t._v("推荐使用"),a("code",[t._v("deleteOne(<query>)")]),t._v("（删除一个）和"),a("code",[t._v("deleteMany(<query>)")]),t._v("（删除多个）")]),t._v(" "),a("li",[t._v("清空集合："),a("code",[t._v("db.col.remove({})")])])]),t._v(" "),a("h3",{attrs:{id:"查询文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询文档"}},[t._v("#")]),t._v(" 查询文档")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("db.collection.find(query, projection)")])]),t._v(" "),a("li",[a("code",[t._v("db.collection.findOne(query, projection)")])]),t._v(" "),a("li",[a("code",[t._v("projection")]),t._v(",可选，使用投影操作符指定返回的键。查询时返回文档中所有键值， 只需省略该参数即可。")])]),t._v(" "),a("h2",{attrs:{id:"操作符"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#操作符"}},[t._v("#")]),t._v(" 操作符")]),t._v(" "),a("h3",{attrs:{id:"条件操作符"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#条件操作符"}},[t._v("#")]),t._v(" 条件操作符")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("操作")]),t._v(" "),a("th",[t._v("格式")]),t._v(" "),a("th",[t._v("备注")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("等于")]),t._v(" "),a("td",[a("code",[t._v("{<key>:<value>}")])]),t._v(" "),a("td",[t._v("等号"),a("code",[t._v("=")])])]),t._v(" "),a("tr",[a("td",[t._v("小于")]),t._v(" "),a("td",[a("code",[t._v("{<key>:{$lt:<value>}}")])]),t._v(" "),a("td",[t._v("小于号"),a("code",[t._v("<")])])]),t._v(" "),a("tr",[a("td",[t._v("小于或等于")]),t._v(" "),a("td",[a("code",[t._v("{<key>:{$lte:<value>}}")])]),t._v(" "),a("td",[t._v("小于等于号"),a("code",[t._v("<=")])])]),t._v(" "),a("tr",[a("td",[t._v("大于")]),t._v(" "),a("td",[a("code",[t._v("{<key>:{$gt:>value>}}")])]),t._v(" "),a("td",[t._v("大于号"),a("code",[t._v(">")])])]),t._v(" "),a("tr",[a("td",[t._v("大于等于")]),t._v(" "),a("td",[a("code",[t._v("{<key>:{$gte:>value>}}")])]),t._v(" "),a("td",[t._v("大于等于号"),a("code",[t._v(">=")])])]),t._v(" "),a("tr",[a("td",[t._v("不等于")]),t._v(" "),a("td",[a("code",[t._v("{<key>:{$ne:<value>}")])]),t._v(" "),a("td",[t._v("不等号"),a("code",[t._v("!=")])])])])]),t._v(" "),a("h3",{attrs:{id:"and-条件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#and-条件"}},[t._v("#")]),t._v(" AND 条件")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("db.col.find({key1:value1, key2:value2}).pretty()")])])]),t._v(" "),a("h3",{attrs:{id:"or-条件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#or-条件"}},[t._v("#")]),t._v(" OR 条件")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("col"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$or")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("key1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" value1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("key2")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("value2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pretty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h3",{attrs:{id:"and-和-or-联合使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#and-和-or-联合使用"}},[t._v("#")]),t._v(" AND 和 OR 联合使用")]),t._v(" "),a("ul",[a("li",[a("code",[t._v('db.col.find({"count": {$gt:50}, $or: [{"name": "名称"},{"title": "标题"}]}).pretty()')])])]),t._v(" "),a("h3",{attrs:{id:"type-操作符"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#type-操作符"}},[t._v("#")]),t._v(" $type 操作符")]),t._v(" "),a("ul",[a("li",[t._v("$type操作符是基于BSON类型来检索集合中匹配的数据类型，并返回结果。")])]),t._v(" "),a("h3",{attrs:{id:"其他api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他api"}},[t._v("#")]),t._v(" 其他API")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("db.COLLECTION_NAME.find().limit(NUMBER)")]),t._v("，limit()方法接受一个数字参数，该参数指定从MongoDB中读取的记录条数。")]),t._v(" "),a("li",[a("code",[t._v("db.COLLECTION_NAME.find().sort({KEY:1})")]),t._v(", 1 为升序排列，而 -1 是用于降序排列。")])]),t._v(" "),a("h2",{attrs:{id:"索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#索引"}},[t._v("#")]),t._v(" 索引")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("db.collection.createIndex(keys, options)")]),t._v(" 创建索引，Key 值为你要创建的索引字段，1 为指定按升序创建索引，如果你想按降序来创建索引指定为 -1 即可。")]),t._v(" "),a("li",[a("code",[t._v("db.values.createIndex({open: 1, close: 1}, {background: true})")]),t._v("，建索引过程会阻塞其它数据库操作，background可指定以后台方式创建索引。")])]),t._v(" "),a("h2",{attrs:{id:"聚合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#聚合"}},[t._v("#")]),t._v(" 聚合")]),t._v(" "),a("h2",{attrs:{id:"复制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#复制"}},[t._v("#")]),t._v(" 复制")]),t._v(" "),a("ul",[a("li",[t._v("mongodb的复制至少需要两个节点。其中一个是主节点，负责处理客户端请求，其余的都是从节点，负责复制主节点上的数据。")]),t._v(" "),a("li",[t._v("主节点记录在其上的所有操作oplog，从节点定期轮询主节点获取这些操作，然后对自己的数据副本执行这些操作，从而保证从节点的数据与主节点一致。")])])])}),[],!1,null,null,null);a.default=r.exports}}]);