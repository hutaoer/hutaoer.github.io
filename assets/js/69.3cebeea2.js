(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{508:function(t,s,a){"use strict";a.r(s);var e=a(2),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"个案管理平台性能优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#个案管理平台性能优化"}},[t._v("#")]),t._v(" 个案管理平台性能优化")]),t._v(" "),s("h2",{attrs:{id:"背景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[t._v("#")]),t._v(" 背景")]),t._v(" "),s("ul",[s("li",[t._v("做性能优化有一个原则，非必要的时候，无需过多关注性能问题。")]),t._v(" "),s("li",[t._v("先阶段项目存在以下一些问题，优化化，是可以带来一些收益的。\n"),s("ul",[s("li",[t._v("个案项目打包，使用的单文件输出方式，打出来的文件较大。")]),t._v(" "),s("li",[t._v("本地开发，编译的时间较长。")]),t._v(" "),s("li",[t._v("开发编译和代码本身都有可以优化的地方。")])])])]),t._v(" "),s("h2",{attrs:{id:"分析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#分析"}},[t._v("#")]),t._v(" 分析")]),t._v(" "),s("ul",[s("li",[t._v("单文件打包，不利于公共文件的提取，页面访问速度也较慢。打包也慢。")]),t._v(" "),s("li",[t._v("代码本身的问题，可以考虑打包为common-chunk，或者使用cdn方式引入。\n"),s("ul",[s("li",[t._v("1.btn.js 多次依赖 80K * 7 = 560KB")]),t._v(" "),s("li",[t._v("2.antd-mobile 引入，应该不需要。335KB")]),t._v(" "),s("li",[t._v("3.antd 引入 使用 cdn。2.1MB")]),t._v(" "),s("li",[t._v("4.添加tree-shaking")]),t._v(" "),s("li",[t._v("5.删除无用依赖")]),t._v(" "),s("li",[t._v("6.echarts 引入 1.08M")]),t._v(" "),s("li",[t._v("7.lodash 531KB")])])])]),t._v(" "),s("h2",{attrs:{id:"优化方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优化方案"}},[t._v("#")]),t._v(" 优化方案")]),t._v(" "),s("h3",{attrs:{id:"修改为按需加载引入后"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改为按需加载引入后"}},[t._v("#")]),t._v(" 修改为按需加载引入后")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("webpack")]),t._v("版本"),s("code",[t._v("4.46.0")]),t._v("，但是页面组件引入方式，修改为按需引入。")])]),t._v(" "),s("h4",{attrs:{id:"本地dev时间对比"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#本地dev时间对比"}},[t._v("#")]),t._v(" 本地dev时间对比")]),t._v(" "),s("ul",[s("li",[t._v("虽然只统计了一次的编译时间，但是提升还是比较明显的。")]),t._v(" "),s("li",[t._v("优化前：69332ms\n"),s("ul",[s("li",[s("img",{attrs:{src:"https://static.aistarfish.com/front-release/file/F2023090718003759100009983.2.png",alt:"1"}})])])]),t._v(" "),s("li",[t._v("优化后：42242ms\n"),s("ul",[s("li",[s("img",{attrs:{src:"https://static.aistarfish.com/front-release/file/F2023090718003751400004741.1.png",alt:"2"}})])])])]),t._v(" "),s("h4",{attrs:{id:"打包时间对比"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#打包时间对比"}},[t._v("#")]),t._v(" 打包时间对比")]),t._v(" "),s("ul",[s("li",[t._v("打包时间，快了近一倍左右。")]),t._v(" "),s("li",[t._v("优化前：265123ms\n"),s("ul",[s("li",[s("img",{attrs:{src:"https://static.aistarfish.com/front-release/file/F2023090718032344300002666.3.png",alt:"3"}})])])]),t._v(" "),s("li",[t._v("优化后：137557ms\n"),s("ul",[s("li",[s("img",{attrs:{src:"https://static.aistarfish.com/front-release/file/F2023090718032370500009792.4.png",alt:"4"}})])])])]),t._v(" "),s("h3",{attrs:{id:"删除无用的依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#删除无用的依赖"}},[t._v("#")]),t._v(" 删除无用的依赖")]),t._v(" "),s("ul",[s("li",[t._v("使用："),s("code",[t._v("depcheck")]),t._v("，输出没有用到的包")]),t._v(" "),s("li",[t._v("注意：这里输出的npm包，不一定真正没有用到，需要仔细对比后，再删除。")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("Unused dependencies * @aistarfish/im-js-sdk * @aistarfish/pro-table * @babel/runtime * @netless/white-video-plugin * draftjs-utils * faker * js-md5 * promise * raf * react-cool-onclickoutside * react-dev-utils * react-shadow * whatwg-fetch Unused devDependencies * @babel/plugin-proposal-decorators * @babel/plugin-proposal-optional-chaining * @babel/plugin-transform-runtime * @babel/preset-react * @commitlint/cli * @commitlint/config-conventional * babel-eslint * babel-plugin-import * babel-preset-react-app * commitizen * cssnano * cz-conventional-changelog * eslint-loader * jest * mini-css-extract-plugin * sass-resources-loader Missing dependencies * src: ./src/utils/fetch.js * @cm/util: ./src/utils/h5Fetch.js * dayjs: ./src/utils/index.js * @cm/hooks: ./src/entry/caseManager/util/medicineFn.js * @cm/assets: ./src/entry/caseManager/util/typing.js * @cm/pages: ./src/entry/caseManager/util/staticList/manageList.jsx * @cm/services: ./src/entry/caseManager/util/common/stageRequest/index.js * @cm/api: ./src/entry/caseManager/services/nutrition.js * @cm/components: ./src/entry/caseManager/pages/nutrition/index.jsx * @cm/stores: ./src/entry/caseManager/pages/dashBoard/index.jsx * @cm/constants: ./src/entry/caseManager/pages/TemplatePlan/components/tempEditModal/index.jsx * @cm/router: ./src/entry/caseManager/layout/main/index.js \n")])])]),s("h3",{attrs:{id:"二方包优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二方包优化"}},[t._v("#")]),t._v(" 二方包优化")]),t._v(" "),s("ul",[s("li",[t._v("二方包的打包不是最优的，有的包含了较多的冗余代码，可以做优化。")]),t._v(" "),s("li",[t._v("针对不同的端，使用不同的antd组件库。并且仅放到开发依赖，不放入到生产依赖。")]),t._v(" "),s("li",[t._v("公司业务线，各个项目 antd-mobile 存在两天版本混用的情况，需要老项目做升级。")])]),t._v(" "),s("h3",{attrs:{id:"三方包优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三方包优化"}},[t._v("#")]),t._v(" 三方包优化")]),t._v(" "),s("h4",{attrs:{id:"lodash、moment"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lodash、moment"}},[t._v("#")]),t._v(" lodash、moment")]),t._v(" "),s("ul",[s("li",[t._v("方案一：具体到使用的某个方法，而不是整个引入。\n"),s("ul",[s("li",[s("code",[t._v("import {debounce} from 'lodash'")])]),t._v(" "),s("li",[t._v("替换为 "),s("code",[t._v("import debounce from 'lodash/debounce'")])])])]),t._v(" "),s("li",[t._v("方案二：将lodash替换为lodash-es")]),t._v(" "),s("li",[t._v("方案三：使用webpack插件实现")])]),t._v(" "),s("h4",{attrs:{id:"bn-js-draft-js-优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#bn-js-draft-js-优化"}},[t._v("#")]),t._v(" bn.js/draft-js 优化")]),t._v(" "),s("ul",[s("li",[t._v("这些包在二方包和项目中都有重复使用。")]),t._v(" "),s("li",[t._v("因为 "),s("code",[t._v("webpack")]),t._v(" 在递归查找依赖的时候会默认去第三方库的 "),s("code",[t._v("node_modules")]),t._v(" 目录中查找并单独打包，所以每个库只要对 "),s("code",[t._v("bn.js")]),t._v(" 有依赖就会单独打包一次。\n告诉"),s("code",[t._v("webpack")]),t._v("，查找依赖时遇到"),s("code",[t._v("bn.js")]),t._v("就去 "),s("code",[t._v("nodejs")]),t._v("的命令执行目录的 "),s("code",[t._v("node_modules")]),t._v(" 目录中查找依赖。")]),t._v(" "),s("li",[s("code",[t._v("webpack")]),t._v(" 配置:")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("alias")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'@cm'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../caseManager'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'bn.js'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cwd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node_modules'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bn.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'draft-js'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cwd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node_modules'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'draft-js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),s("h3",{attrs:{id:"antd-优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#antd-优化"}},[t._v("#")]),t._v(" antd 优化")]),t._v(" "),s("ul",[s("li",[t._v("使用"),s("code",[t._v("cdn")]),t._v("代替"),s("code",[t._v("npm")]),t._v("，因为antd压缩后大小为"),s("code",[t._v("274KB")]),t._v("，而项目中按需加载后引入大小为"),s("code",[t._v("208KB")]),t._v("，通过"),s("code",[t._v("cdn")]),t._v("引入，"),s("code",[t._v("dev")]),t._v("和"),s("code",[t._v("build")]),t._v("可以减小"),s("code",[t._v("208KB")]),t._v("，收益更大些。")]),t._v(" "),s("li",[s("code",[t._v("css")]),t._v("减少"),s("code",[t._v("67KB")]),t._v("左右。")]),t._v(" "),s("li",[t._v("优化前后对比如下：")]),t._v(" "),s("li",[s("img",{attrs:{src:"https://static.aistarfish.com/front-release/file/F2023090718144161600001439.6.png",alt:"6"}})])]),t._v(" "),s("h3",{attrs:{id:"echarts-优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#echarts-优化"}},[t._v("#")]),t._v(" echarts 优化")]),t._v(" "),s("ul",[s("li",[t._v("同"),s("code",[t._v("antd")]),t._v("的方案，使用"),s("code",[t._v("cdn")])]),t._v(" "),s("li",[t._v("优化前后对比如下：")]),t._v(" "),s("li",[s("img",{attrs:{src:"https://static.aistarfish.com/front-release/file/F2023090718144167200004522.7.png",alt:"7"}})])]),t._v(" "),s("h2",{attrs:{id:"优化前后页面加载对比"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优化前后页面加载对比"}},[t._v("#")]),t._v(" 优化前后页面加载对比")]),t._v(" "),s("ul",[s("li",[t._v("首屏加载时间对比：")]),t._v(" "),s("li",[s("img",{attrs:{src:"https://static.aistarfish.com/front-release/file/F2023090718170772400006765.8.png",alt:"8"}})])])])}),[],!1,null,null,null);s.default=n.exports}}]);